<html>
  <head>
    <title>課題5</title>
    <script type="text/javascript">
      // 生命体が存在するかの情報
      let lifes = new Array(5);
      for (let i=0; i<lifes.length; i++) {
        lifes[i] = new Array(5).fill(false);  
      }  
      
      let startFlag = false;  // シミュレーションが開始しているかのフラグ

      function setLife(numBtn) {
        if (!startFlag) {  // シミュレーションが開始していない
          // true,falseを反転
          let index = numBtn - 1;
          let y = parseInt((numBtn-1) / 5);
          let x = parseInt((numBtn-1) % 5);
          
          lifes[y][x] = !lifes[y][x];

          setColor(x, y);           
        }
      }

      function setColor(x, y) {
        if (lifes[y][x]) {  // true
          // 背景色を緑にする
          document.getElementsByClassName("btn-" + (y+1) + "-" + (x+1))[0].style.background = "green";
        } else {  // false 
          // 背景色を白にする
          document.getElementsByClassName("btn-" + (y+1) + "-" + (x+1))[0].style.background = "white";
        }
      }

      function startSimulation() {
        startFlag = true;
        let cntGeneration = 0;
        // 配列の値渡し
        idSimulation = setInterval(() => {
          if (!progGeneration()) {
            clearInterval(idSimulation);
          }
          cntGeneration += 1;
          document.getElementById("num-generation").innerHTML = cntGeneration;
        }, 1000);
      }

      function progGeneration() {
        // 配列の値渡し
        const tmpLifes = new Array(5);
        for (let i=0; i<5; i++) {
          tmpLifes[i] = Array.from(lifes[i]);
        }
        for (let y=0; y<5; y++) {
          for (let x=0; x<5; x++) {
            const numAroundLifes = cntAroundLife(tmpLifes, x, y);
            if (lifes[y][x] == true) {
              if (numAroundLifes <= 1 || numAroundLifes >= 4) {
                lifes[y][x] = false;
              }
            } else {
              if (numAroundLifes == 3) {
                lifes[y][x] = true;
              }
            }
          }
        }

        let cntAlive = 0;
        for (let x=0; x<5; x++) {
          for(let y=0; y<5; y++) {
            setColor(x, y);
            if (lifes[y][x]) {
              cntAlive += 1;
            }
          }
        }

        if (cntAlive > 0) {
          return true;
        }

        return false;
      }

      function cntAroundLife(tmpLifes, x, y) {
        let cntLife = 0;  // 生命体が存在している(true)個数をカウント
        // 全ての要素の周りの8要素を走査  
        for (let i=-1; i<=1; i++) {
          for (let j=-1; j<=1; j++) {
            let _y = y+i;  // 探索する行
            let _x = x+j;  // 探索する列
            if (_y >= 0 && _y < 5 && _x >= 0 && _x < 5 && !(i==0 && j==0)) {  // 範囲外と自分自身を除く
              if (tmpLifes[_y][_x] == true) {
                cntLife += 1;
              }
            }
          }
        }

        return cntLife;
      }

    </script>
  </head>
  <body>
    <div class="content">
      <table border="1" style="border-collapse: collapse">
        <tr>
          <td><div class="btn-1-1" style="width:50; height:50" onclick="setLife(1)"></div></td>
          <td><div class="btn-1-2" style="width:50; height:50" onclick="setLife(2)"></div></td>
          <td><div class="btn-1-3" style="width:50; height:50" onclick="setLife(3)"></div></td>
          <td><div class="btn-1-4" style="width:50; height:50" onclick="setLife(4)"></div></td>
          <td><div class="btn-1-5" style="width:50; height:50" onclick="setLife(5)"></div></td>
        </tr>
        <tr>
          <td><div class="btn-2-1" style="width:50; height:50" onclick="setLife(6)"></div></td>
          <td><div class="btn-2-2" style="width:50; height:50" onclick="setLife(7)"></div></td>
          <td><div class="btn-2-3" style="width:50; height:50" onclick="setLife(8)"></div></td>
          <td><div class="btn-2-4" style="width:50; height:50" onclick="setLife(9)"></div></td>
          <td><div class="btn-2-5" style="width:50; height:50" onclick="setLife(10)"></div></td>
        </tr>
        <tr>
          <td><div class="btn-3-1" style="width:50; height:50" onclick="setLife(11)"></div></td>
          <td><div class="btn-3-2" style="width:50; height:50" onclick="setLife(12)"></div></td>
          <td><div class="btn-3-3" style="width:50; height:50" onclick="setLife(13)"></div></td>
          <td><div class="btn-3-4" style="width:50; height:50" onclick="setLife(14)"></div></td>
          <td><div class="btn-3-5" style="width:50; height:50" onclick="setLife(15)"></div></td>
        </tr>
        <tr>
          <td><div class="btn-4-1" style="width:50; height:50" onclick="setLife(16)"></div></td>
          <td><div class="btn-4-2" style="width:50; height:50" onclick="setLife(17)"></div></td>
          <td><div class="btn-4-3" style="width:50; height:50" onclick="setLife(18)"></div></td>
          <td><div class="btn-4-4" style="width:50; height:50" onclick="setLife(19)"></div></td>
          <td><div class="btn-4-5" style="width:50; height:50" onclick="setLife(20)"></div></td>
        </tr>
        <tr>
          <td><div class="btn-5-1" style="width:50; height:50" onclick="setLife(21)"></div></td>
          <td><div class="btn-5-2" style="width:50; height:50" onclick="setLife(22)"></div></td>
          <td><div class="btn-5-3" style="width:50; height:50" onclick="setLife(23)"></div></td>
          <td><div class="btn-5-4" style="width:50; height:50" onclick="setLife(24)"></div></td>
          <td><div class="btn-5-5" style="width:50; height:50" onclick="setLife(25)"></div></td>
        </tr>
      </table>
      <br>
      <div class="cnt-generation" style="text-decoration: underline">
        <span id="num-generation">0</span>世代目
      </div>
      <br>
      <input type="button" value="シミュレーション開始" onclick="startSimulation()">
    </div>
  </body>
</html>